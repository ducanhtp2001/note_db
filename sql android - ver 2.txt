create database android;

drop table message;
drop table note;
drop table taikhoanonline;
drop table taikhoan;
drop table lichhoc;
drop table dangkimonhoc;
drop table danhsachloptinchi;
drop table danhsachmonhoc;
drop table thongtinsinhvien;


CREATE TABLE thongtinsinhvien (
    id INT PRIMARY KEY AUTO_INCREMENT,
    hoten VARCHAR(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL,
    ngaysinh DATE NOT NULL,
    gioitinh VARCHAR(10) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci,
    quequan VARCHAR(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL,
    gmail VARCHAR(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci,
    sdt VARCHAR(15) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci,
    khoa INT NOT NULL,
    nienkhoa INT NOT NULL,
    lop INT NOT NULL
);

CREATE TABLE danhsachmonhoc (
    id INT PRIMARY KEY AUTO_INCREMENT,
    soTin INT,
    tenmon VARCHAR(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci
);

CREATE TABLE danhsachloptinchi (
    id INT PRIMARY KEY AUTO_INCREMENT,
    mamon INT,
    loptinchi INT,
    tenGiaoVien VARCHAR(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL,
    FOREIGN KEY (mamon) REFERENCES danhsachmonhoc(id)
);

CREATE TABLE dangkimonhoc (
    id INT PRIMARY KEY AUTO_INCREMENT,
    idsinhvien INT,
    mamon INT,
    loptinchi INT,
    FOREIGN KEY (idsinhvien) REFERENCES thongtinsinhvien(id),
    FOREIGN KEY (mamon) REFERENCES danhsachmonhoc(id),
    FOREIGN KEY (loptinchi) REFERENCES danhsachloptinchi(id)
);

CREATE TABLE lichhoc (
    id INT PRIMARY KEY AUTO_INCREMENT,
    mamon INT,
    loptinchi INT,
    ngayhoc DATE,
    cahoc INT,
    phonghoc VARCHAR(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci,
    FOREIGN KEY (mamon) REFERENCES danhsachmonhoc(id),
    FOREIGN KEY (loptinchi) REFERENCES danhsachloptinchi(id)
);

CREATE TABLE taikhoan (
    id INT PRIMARY KEY AUTO_INCREMENT,
    idsinhvien INT,
    taikhoan VARCHAR(20) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci,
    matkhau TEXT,
    iv TEXT,
    avatar TEXT DEFAULT 'https://example.com/default-avatar.png',
    FOREIGN KEY (idsinhvien) REFERENCES thongtinsinhvien(id)
);

CREATE TABLE taikhoanonline (
    id INT PRIMARY KEY AUTO_INCREMENT,
    idtaikhoan INT,
    online INT,
    FOREIGN KEY (idtaikhoan) REFERENCES taikhoan(id)
);

CREATE TABLE note (
    id INTEGER PRIMARY KEY AUTO_INCREMENT,
    idsinhvien INT,
    tieude TEXT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci,
    ngayTao DATE,
    ngayCapNhat DATE,
    noidung TEXT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci,
    noidungcua VARCHAR(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci,
    FOREIGN KEY (idsinhvien) REFERENCES thongtinsinhvien(id)
);

CREATE TABLE message (
    id INTEGER PRIMARY KEY AUTO_INCREMENT,
    idsinhvien INT,
    thoigian TEXT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci,
    mamon INT,
    loptinchi INT,
    tinnhan TEXT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci,
    coimg INT,
    img LONGTEXT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci,
    FOREIGN KEY (idsinhvien) REFERENCES thongtinsinhvien(id),
    FOREIGN KEY (mamon) REFERENCES danhsachmonhoc(id),
    FOREIGN KEY (loptinchi) REFERENCES danhsachloptinchi(id)
);







SELECT *
FROM (danhsachmonhoc
JOIN danhsachloptinchi ON danhsachmonhoc.id = danhsachloptinchi.mamon)
JOIN dangkimonhoc on (dangkimonhoc.mamon = danhsachloptinchi.mamon and dangkimonhoc.loptinchi = danhsachloptinchi.loptinchi);

SELECT *
FROM ((danhsachmonhoc
JOIN danhsachloptinchi ON danhsachmonhoc.id = danhsachloptinchi.mamon)
JOIN dangkimonhoc on (dangkimonhoc.mamon = danhsachloptinchi.mamon and dangkimonhoc.loptinchi = danhsachloptinchi.loptinchi)) join lichhoc on (dangkimonhoc.mamon = lichhoc.mamon and dangkimonhoc.loptinchi = lichhoc.loptinchi);

SELECT tenmon, sotin, lichhoc.mamon, lichhoc.loptinchi, tengiaovien, idsinhvien,
ngayhoc, cahoc, phonghoc
FROM ((danhsachmonhoc
JOIN danhsachloptinchi ON danhsachmonhoc.id = danhsachloptinchi.mamon)
JOIN dangkimonhoc on (dangkimonhoc.mamon = danhsachloptinchi.mamon and dangkimonhoc.loptinchi = danhsachloptinchi.loptinchi)) join lichhoc on (dangkimonhoc.mamon = lichhoc.mamon and dangkimonhoc.loptinchi = lichhoc.loptinchi)
ORDER BY lichhoc.ngayhoc;






